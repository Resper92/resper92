<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile</title>
    <style>
        #itemForm, #historyTable {
            display: none; /* Nasconde il form e la tabella inizialmente */
        }
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 8px;
        }
        .logout-btn {
            margin: 10px 0;
            padding: 10px 15px;
            background-color: #f44336;
            color: white;
            border: none;
            cursor: pointer;
        }
        .logout-btn:hover {
            background-color: #d32f2f;
        }
    </style>
    <script>
        function showForm() {
            document.getElementById('itemForm').style.display = 'block';
            document.getElementById('showButton').style.display = 'none';
        }

        function toggleTable() {
            const table = document.getElementById('historyTable');
            const toggleButton = document.getElementById('toggleButton');
            if (table.style.display === 'none' || table.style.display === '') {
                table.style.display = 'table';
                toggleButton.textContent = 'Hide Search History';
            } else {
                table.style.display = 'none';
                toggleButton.textContent = 'Show Search History';
            }
        }
    </script>
</head>
<body>
    <!-- Sezione Logout -->
    <form action="/logout" method="POST">
        <button type="submit" class="logout-btn">Logout</button>
    </form>

    <!-- Sezione Profilo -->
    <h2>Profile</h2>
    {% if user %}
        <ul>
            <li><strong>Name:</strong> {{ user.full_name }}</li>
            <li><strong>Contact:</strong> {{ user.contacts }}</li>
            <li><strong>IPN:</strong> {{ user.ipn }}</li>
            <li><strong>Photo:</strong> <img src="{{ user.photo }}" alt="User photo" style="width:150px;height:auto;"></li>
            <li><strong>Passport:</strong> {{ user.passport }}</li>
        </ul>
    {% else %}
        <p>User not found.</p>
    {% endif %}

    <!-- Sezione Aggiunta Item -->
    <h1>Add Item</h1>
    <button id="showButton" onclick="showForm()">Add Item</button>

    <form id="itemForm" action="/item" method="post">
        Name: <br>
        <input type="text" name="name" required><br>
        Photo URL:<br>
        <input type="text" name="photo" required><br>
        Description: <br>
        <input type="text" name="description" required><br>
        Price per hour: <br>
        <input type="number" name="price_hour" step="0.01" required><br>
        Price per day:<br>
        <input type="number" name="price_day" step="0.01" required><br>
        Price per week: <br>
        <input type="number" name="price_week" step="0.01" required><br>
        Price per month: <br>
        <input type="number" name="price_month" step="0.01" required><br>
        <input type="submit" value="Send">
    </form>

    <!-- Sezione Cronologia -->
    <h2>Search History</h2>
    <button id="toggleButton" onclick="toggleTable()">Show Search History</button>

    <div id="historyTable">
        <p>History Count: {{ history|length }}</p>
        {% if history %}
            <table>
                <tr>
                    <th>User</th>
                    <th>Text</th>
                    <th>Timestamp</th>
                </tr>
                {% for one_history in history %}
                    <tr>
                        <td>{{ one_history['user'] }}</td>
                        <td>{{ one_history['search_text'] }}</td>
                        <td>{{ one_history['timestamp'] }}</td>
                    </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>No search history available.</p>
        {% endif %}
    </div>
</body>
</html>
